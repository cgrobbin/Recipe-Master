{% extends 'base.html' %}
{% block content %}

<h3>{{ recipe.title }}</h3>

<div class="recipe-detail">
    <div class="row">
        <div class="col m6 s12">
            <img class="recipe-pic" src="{{ recipe.url }}" alt="recipe-pic">
            {% if user.is_authenticated %}
                {% if recipe.author == request.user %}
                    <form action="{% url 'recipe_photo' recipe.id %}" enctype="multipart/form-data" method="POST">
                        {% csrf_token %}
                        <input type="file" name="recipe-detail-photo-file">
                        <input type="submit" class="btn" value="Update Photo">
                    </form>
                {% endif %}
            {% endif %}
        </div>
        <div class="col m6 s12">
            {% if user.is_authenticated %}
                {% if recipe.author == request.user %}
                    <button data-target="modal3" class="btn modal-trigger">Edit Recipe</button>
                    <button data-target="modal4" class="btn modal-trigger">Delete Recipe</button>
                {% endif %}
            {% endif %}
            <p>Author: {{ recipe.author.username }}</p>
            <p>Prep Time: {{ recipe.prep_time }}</p>
            <p>Cook Time: {{ recipe.cook_time }}</p>
            <p>Servings: {{ recipe.servings }}</p>
        </div>
    </div>
    <div class="row">
        <div class="col m6 s12">
            <ul class="ingredient-list">
                {% for ingredient in recipe.ingredients %}
                    <li>{{ ingredient }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="col m6 s12">
            <ol class="instruction-list">
                {% for instruction in recipe.instructions %}
                    <li>{{ instruction }}</li>
                {% endfor %}
            </ol>
        </div>
    </div>
</div>

{% if user.is_authenticated %}

    <hr>

    <div class="row">
        <h5 class="left">Comments</h5>
        <button class="right btn modal-trigger" data-target="modal5">Add Comment</button>
    </div>

    <section>
        <div class="comments">
            {% for comment in comments %}
                <div class="card">
                    <div class="row">
                        <div class="comment-pic col m3">
                            <img width=85 src="{{ comment.user.url }}" alt="profile-pic">
                        </div>
                        <div class="col m6">
                            <h6>{{ comment.user.user.username }}</h6>
                            <p>{{ comment.content }}</p>
                        </div>
                        {% if comment.user.user == request.user %}
                            <div class="col m3">
                                <button data-target="modal-comment-edit-{{ comment.id }}" class="btn modal-trigger">Edit</button>
                                <button data-target="modal-comment-delete-{{ comment.id }}" class="btn modal-trigger">Delete</button>

                                {% comment %} MODALS {% endcomment %}
                                <div class="modal" id="modal-comment-edit-{{ comment.id }}">
                                    <div class="modal-content">
                                        <form action="{% url 'comment_edit' recipe.id comment.id %}" method="POST">
                                            {% csrf_token %}
                                            <h5>Edit comment below</h5>
                                            <label for="id_content">Comment:</label>
                                            <input type="text" name="content" required="" id="id_content" value="{{ comment.content }}">
                                            <input type="submit" class="btn" value="Save">
                                        </form>
                                    </div>
                                    <div class="modal-footer">
                                        <a href="#!" class="modal-close"></a>
                                    </div>
                                </div>

                                <div class="modal" id="modal-comment-delete-{{ comment.id }}">
                                    <div class="modal-content">
                                        <h5>Are you sure?</h5>
                                    </div>
                                    <div class="modal-footer">
                                        <a href="#!" class="btn modal-close">No</a>
                                        <a href="{% url 'comment_delete' recipe.id comment.id %}" class="btn modal-close">Yes</a>
                                    </div>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>
    </section>

{% endif %}

{% comment %} Modals Here {% endcomment %}

<div class="modal" id="modal3">
    <div class="modal-content">
        <form action="{% url 'recipe_edit' recipe.id %}" method="POST">
            {% csrf_token %}
           <label for="id_title">Title:</label>
            <input type="text" name="title" maxlength="200" required="" id="id_title" value="{{ recipe.title }}">

            <label for="id_prep_time">Prep time:</label>
            <input type="text" name="prep_time" maxlength="25" required="" id="id_prep_time" value="{{ recipe.prep_time }}">

            <label for="id_cook_time">Cook time:</label>
            <input type="text" name="cook_time" maxlength="25" required="" id="id_cook_time" value="{{ recipe.cook_time }}">

            <label for="id_servings">Servings:</label>
            <input type="number" name="servings" required="" id="id_servings" value="{{ recipe.servings }}">

            <label for="id_ingredients">Ingredients:</label>
            <p>Comma separate all ingredients i.e. 2 cups flour, 1 cup sugar, 1Tbsp vanilla...</p>
            <input type="text" name="ingredients" required="" id="id_ingredients" value="{{ recipe.ingredients }}">

            <label for="id_instructions">Instructions:</label>
            <p>Comma separate all instructions i.e. Preheat oven to 350, Sift flour and sugar, Add eggs one at a time...</p>
            <input type="text" name="instructions" required="" id="id_instructions" value="{{ recipe.instructions }}">

            <label for="id_tags">Tags:</label>
            <p>Comma separated i.e. Vegetarian, Gluten Free, Italian</p>
            <input type="text" name="tags" required="" id="id_tags" value="{{ recipe.tags }}">

            <input type="submit" class="btn" value="Save"> 
        </form>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close"></a>
    </div>
</div>

<div class="modal" id="modal4">
    <div class="modal-content">
        <h5>Are you sure?</h5>
    </div>
    <div class="modal-footer">
        <a href="#!" class="btn modal-close">No</a>
        <a href="{% url 'recipe_delete' recipe.id %}" class="btn modal-close">Yes</a>
    </div>
</div>

<div class="modal" id="modal5">
    <div class="modal-content">
        <form action="{% url 'comment_new' recipe.id %}" method="POST">
            {% csrf_token %}
            <h5>Add a comment below</h5>
            <label for="id_content">Comment:</label>
            <input type="text" name="content" required="" id="id_content" placeholder="Scrumptious!">
            <input type="submit" class="btn" value="Add">
        </form>
    </div>
    <div class="modal-footer">
        <a href="#!" class="modal-close"></a>
    </div>
</div>



{% endblock  %}